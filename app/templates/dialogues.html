{% extends "layout.html" %}

{% block content %}
    <!-- Sticky Header within Main Content -->
    <div class="sticky-main-header d-flex justify-content-between g-5">
        <h3 class="me-5">Daily Discourse</h3>
        <div>
            <input type="text" class="search-input " placeholder="Search Topics,Categories,Titles.. " id="searchInput">
            <button class="search-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- This container will be dynamically updated by JavaScript -->
    <div class="discourse-container">
        
        {% if initial_content %}
            
            <!-- A. Display the discourse if it exists -->
            <section id="discourse-section">
                <div class="discourse-meta">
                    <!-- Note: We now access attributes directly, not via .get() -->
                    <!-- And we use a filter to format the date object -->
                    <span id="discourse-date">{{ initial_content.date_posted.strftime('%B %d, %Y') }}</span>
                    <span id="discourse-ref">Reference: {{ initial_content.reference }}</span>
                </div>
                <h4 id="discourse-title">{{ initial_content.title }}</h4>
                <div id="discourse-body">
                    {{ initial_content.body | safe }}
                </div>
            </section>

            <section id="resources-section">
                <h4>Resources & References</h4>
                <ul id="resource-list">
                    {% for resource in initial_content.resources %}
                    <li>
                        <!-- Use resource.type.value to get the string from the Enum -->
                        <span class="resource-type {{ resource.type.value }}">{{ resource.type.value[0] }}</span>
                        <strong>{{ resource.name }}:</strong> {{ resource.link }}
                    </li>
                    {% else %}
                    <li>No resources listed for this discourse.</li>
                    {% endfor %}
                </ul>
            </section>

            <section id="contribute-section">
                <h4>Join this Discourse</h4>
                <p id="contribute-prompt">Share your thoughts on '{{ initial_content.title }}'.</p>
                <textarea placeholder="Contribute your perspective..."></textarea>
                <button class="btn btn-sm">Submit Contribution</button>
                <button class="btn btn-sm"><i class="fa fa-print"></i></button>
            </section>

        {% elif default_content %}
            
            <!-- A. Display the discourse if it exists -->
            <section id="discourse-section">
                <div class="discourse-meta">
                    <!-- Note: We now access attributes directly, not via .get() -->
                    <!-- And we use a filter to format the date object -->
                    <span id="discourse-ref">Reference: {{ default_content.reference }}</span>
                </div>
                <h4 id="discourse-title">{{ default_content.title }}</h4>
                <div id="discourse-body">
                    {{ default_content.body | safe }}
                </div>
            </section>

            <section id="resources-section">
                <h4>Resources & References</h4>
                <ul id="resource-list">
                    {% for resource in default_content.get('resources', []) %}
                    <li>
                        <span class="resource-type {{ resource.type }}">{{ resource.type[0] }}</span>
                        <strong>{{ resource.text }}:</strong> {{ resource.ref }}
                    </li>
                    {% endfor %}
                </ul>
            </section>

            <section id="contribute-section">
                <h4>Join this Discourse</h4>
                <p id="contribute-prompt">Share your thoughts on '{{ initial_content.title }}'.</p>
                <textarea placeholder="Contribute your perspective..."></textarea>
                <button class="btn btn-sm">Submit Contribution</button>
                <button class="btn btn-sm"><i class="fa fa-print"></i></button>
            </section>

        {% else %}

        

            <!-- B. Display a welcoming "empty state" if no discourse exists -->
            <section id="discourse-section">
                <div class="discourse-meta">
                    <span id="discourse-date">Today</span>
                    <span id="discourse-ref">Reference: N/A</span>
                </div>
                <h4 id="discourse-title">Welcome to the Dialogues</h4>
                <div id="discourse-body">
                    <p>There are no approved articles to display at the moment.</p>
                    <p>Please check back soon. An administrator can add new content via the admin panel.</p>
                </div>
            </section>

            <section id="resources-section">
                <h4>Resources & References</h4>
                <ul id="resource-list">
                    <li>No resources to display.</li>
                </ul>
            </section>

            <section id="contribute-section">
                <h4>Join this Discourse</h4>
                <p id="contribute-prompt">Share your thoughts once a topic is available.</p>
                <textarea placeholder="Contribute your perspective..." disabled></textarea>
                <button class="btn btn-sm" disabled>Submit Contribution</button>
                <button class="btn btn-sm" disabled><i class="fa fa-print"></i></button>
            </section>

        {% endif %}
    </div>
{% endblock %}