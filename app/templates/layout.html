<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dialogues of Light{% endblock %}</title>
    
    <!-- Fonts and Icons -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montez&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&family=Play:wght@400;700&family=Style+Script&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&family=Kalam:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
      :root {    
        {% for slug, color in resource_theme_colors.items() %}
          --color-resource-{{ slug }}: {{ color }};
        {% endfor %}
      }
    </style>
    {% block head_extensions %}{% endblock %}
</head>
<body>

    <div class="site-grid">
        
        <nav class="main-nav " id="main-nav">
            <div class="logo-dropdown" >
                <div class="logo">
                    <a href="{{ url_for('main.splash') }}">
                        <h1>Dialogues of Light</h1>
                    </a>
                </div>
                <div class="header-accent-dots" id="logo-dropdown-trigger"></div>
                <div class="nav-item dropdown-menu" id="logo-dropdown-menu">
                {% if current_user.is_authenticated %}
                        <ul>
                            <!-- THIS IS THE NEW LINK -->
                            <li><a class="dropdown-item" href="{{ url_for('main.profile_page') }}">
                                <i class="fas fa-user-edit me-2"></i>My Profile
                            </a></li>

                            <li><a class="dropdown-item" href="#">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a></li>
                            <!-- Your existing logout link -->
                            <li><a class="dropdown-item" href="{{ url_for('main.logout') }}">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    
                {% else %}
                    <ul>
                        <li><a href="{{ url_for('main.login_page') }}" class="nav-link">Login</a></li>
                        <li><a href="{{ url_for('main.registration_page') }}" class="nav-link">Register</a></li>
                    </ul>
                {% endif %}
                </div>
            </div>

            <ul>
                <!-- MODIFIED: Loop through the new database-driven sidebar_data -->
                {% for category in sidebar_data %}
                <li>
                    <!-- The data-topic-id now holds the real Category ID from the database -->
                    <a href="#" class="main-topic-link" data-topic-id="{{ category.id }}">
                        <!-- Icon is a placeholder for now -->
                        <span>{{ category.name }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </nav>

        <!-- Panel 2: Subcategories -->
        <aside class="sub-nav" id="sub-nav">
            <div class="sub-nav-header">
                <h3 id="sub-nav-title"></h3>
                <button class="close-btn" data-close-panel="sub-nav">×</button>
            </div>
            <ul id="sub-nav-list"></ul>
        </aside>

        <!-- NEW - Panel 3: Discourse Titles -->
        <aside class="discourse-nav" id="discourse-nav">
            <div class="discourse-nav-header">
                <h3 id="discourse-nav-title"></h3>
                <button class="close-btn" data-close-panel="discourse-nav">×</button>
            </div>
            <ul id="discourse-nav-list"></ul>
        </aside>

   

        <!-- Main Content Area (This will be filled by other templates) -->
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>

        <!-- Right Sidebar (Data now comes from context_processor) -->
        <aside class="right-sidebar">
            <div class="sidebar-links">
                <h4>Explore</h4>
                <ul>
                    <li><a href="{{ url_for('discourse.dialogues') }}"><i class="fas fa-pen-nib"></i>Dialogues</a></li>
                    <li><a href="{{ url_for('liturgy_bp.liturgy') }}" ><i class="fas fa-bible"></i>Liturgy</a></li>
                    <li><a href="{{ url_for('academic.theology') }}" ><i class="fas fa-graduation-cap"></i>Academy</a></li>  
                    <li><a href="#"><i class="fas fa-book-open"></i> Repositories</a></li>
                    <li><a href="#"><i class="fas fa-hand-holding-heart"></i> Charities</a></li>
                    <li><a href="#"><i class="fas fa-puzzle-piece"></i> Leisure</a></li>
                    
                </ul>
            </div>
                <div class="daily-content">
                    
                    <!-- Section 1: Repurposed for Prayers from TCCP_DAILY API -->
                    <section id="daily-reading">
                        <!-- Add IDs to the h4 and p tags -->
                        <h4 id="reading-title">{{ daily_data.get('reading', {}).get('title', 'Daily Reading') }}</h4>
                        <p id="reading-body">{{ daily_data.get('reading', {}).get('body', 'Content unavailable.') }}</p>
                    </section>

                    <!-- Section 2: Repurposed for Saint of the Day from YORI_DAILY API -->
                    <section id="daily-devotion">
                        <!-- Add IDs to the h4 and p tags -->
                        <h4 id="devotion-title">{{ daily_data.get('devotion', {}).get('title', 'Saint of the Day') }}</h4>
                        <p id="devotion-body">{{ daily_data.get('devotion', {}).get('body', 'Content unavailable.') }}</p>
                    </section>

                    <!-- Section 3: Repurposed for Rosary Mysteries from YORI_DAILY API -->
                    <section id="daily-prayer">
                        <!-- Add IDs to the h4 and p tags -->
                        <h4 id="prayer-title">{{ daily_data.get('prayer', {}).get('title', 'Rosary Mysteries') }}</h4>
                        <em id="prayer-body">{{ daily_data.get('prayer', {}).get('body', 'Content unavailable.') }}</em>
                    </section>
                    
                </div>
        </aside>
    </div>
<!-- NEW: Sophisticated Overlay Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="{{ url_for('discourse.dialogues') }}">Enter Dialogues</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Mission & Vision</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Resources</h4>
                <ul>
                    <li><a href="#">Featured Articles</a></li>
                    <li><a href="#">Academic Repositories</a></li>
                    <li><a href="#">Scholarly Journals</a></li>
                    <li><a href="#">Papal Newsletters</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Liturgy & Prayer</h4>
                <ul>
                    <li><a href="#">Daily Commentaries</a></li>
                    <li><a href="#">Book of Prayers</a></li>
                    <li><a href="#">Chaplets & Rosaries</a></li>
                    <li><a href="#">The Litanies</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Partners</h4>
                <ul>
                    <li><a href="#">Affiliated Schools</a></li>
                    <li><a href="#">Partner Organisations</a></li>
                    <li><a href="#">Supported Charities</a></li>
                    <li><a href="#">Media Affiliates</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p class="tight-p">Temple of Divine Wisdom, Tabernacle of Divine Knowledge</p>
            <p class="tight-p">&</p>
            <p class="tight-p">Sunshine of heaven and earth.</p>

            <p>© {{ now().year }} </p>
        </div>
    </footer>


    <!-- 2. Upload Image Modal (Updated for new style) -->
    <div class="modal-overlay" id="image-modal-overlay"></div>
    <div class="modal" id="image-modal" style="max-width: 600px;">
        <div class="modal-header">
            <h3><i class="fas fa-image" style="margin-right: 8px;"></i>Upload & Convert Image</h3>
            <button class="modal-close" data-modal-close>×</button>
        </div>
        <div class="modal-body">
            <!-- IMPORTANT: enctype must be present for file uploads -->
            <form id="image-form" class="signup-form" enctype="multipart/form-data">
                
                <div class="form-grid-row">
                    <label for="image-file">Select Image File *</label>
                    <input type="file" id="image-file" name="image_file" accept="image/*" required>
                </div>
                
                <div class="form-grid-row">
                    <label for="image-filename">Assign Filename *<br><small>(no extension)</small></label>
                    <input type="text" id="image-filename" name="filename" required>
                </div>

                <!-- Image Preview Row -->
                <div class="form-grid-row">
                    <label>Image Preview</label>
                    <div class="image-preview-container">
                        <img id="image-preview" src="#" alt="Image Preview" style="display:none;">
                    </div>
                </div>
                
                <div class="form-footer">
                    <span></span> <!-- Spacer -->
                    <button type="submit" class="btn-signup">Upload & Convert</button>
                </div>
                
                <p id="image-status" class="status-message"></p>
            </form>
        </div>
    </div>


    <!-- Data Injection & Scripts -->
    <script>
            // NEW: Pass the structured sidebar data to JavaScript
        const SIDEBAR_DATA = {{ sidebar_data | tojson }};
        const CONTENT_DATA = {{ content_data | tojson if content_data else '{}' }};
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

</body>
</html>