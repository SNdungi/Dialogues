{% extends "layout.html" %}

{% block title %}Liturgy of the Day{% endblock %}

{% block head_extensions %}
<link rel="stylesheet" href="{{ url_for('liturgy_bp.static', filename='liturgy.css') }}">

{% endblock %}

{% block content %}
    <!-- Sticky Header within Main Content (Inspired by dialogues.html) -->
    <div class="sticky-main-header d-flex justify-content-between align-items-center">
        <h3 class="mb-0">Liturgy of the Day</h3>
        <div class="d-flex align-items-center">
            <span class="me-3 fs-6 text-muted" id="liturgy-date-display">{{ date_for_display }}</span>
            <div class="discourse-navigation-controls">
                <!-- We will add JavaScript to control these later -->
                <button id="prev-day-btn" class="btn btn-outline-secondary btn-sm" title="Previous Day">
                    <i class="fa fa-chevron-left"></i>
                </button>
                <button id="next-day-btn" class="btn btn-outline-secondary btn-sm" title="Next Day">
                    <i class="fa fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main liturgy content container -->
    <div class="discourse-container" id="liturgy-content-wrapper">
        
        {% if liturgy_data and not liturgy_data.error %}
            <!-- ================================================================ -->
            <!-- 1. Liturgical Information Header                                 -->
            <!-- ================================================================ -->
            <div class="liturgy-info-card" style="--liturgical-color: {{ liturgy_data.color.hex }};">
                <h2>{{ liturgy_data.celebration }}</h2>
                <div class="liturgy-meta">
                    <span>Season: {{ liturgy_data.season }}</span> | 
                    <span>Week: {{ liturgy_data.season_week }}</span>
                </div>
            </div>

            <!-- ================================================================ -->
            <!-- 2. Daily Readings Section                                        -->
            <!-- ================================================================ -->
            <section id="readings-section">
                {% for reading in liturgy_data.readings %}
                <div class="reading-card">
                    <h4 class="reading-title">{{ reading.title }}</h4>
                    <span class="reading-reference">{{ reading.reference }}</span>
                    
                    {% if reading.title.lower().startswith('responsorial') %}
                        <p class="psalm-response">R. {{ reading.response }}</p>
                    {% endif %}

                    <div class="reading-body">
                        {# The body is pre-formatted with paragraphs from our Python route #}
                        {% for paragraph in reading.body %}
                            <p>{{ paragraph | safe }}</p>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </section>
            
            <!-- ================================================================ -->
            <!-- 3. Daily Prayers / Propers Section                               -->
            <!-- ================================================================ -->
            <section id="prayers-section" class="mt-4">
                <h4>Mass Prayers</h4>
                {% for prayer in liturgy_data.prayers %}
                <div class="reading-card">
                    <h5 class="reading-title">{{ prayer.title }}</h5>
                    <div class="reading-body">
                         <p><em>{{ prayer.body | safe }}</em></p>
                    </div>
                </div>
                {% else %}
                <p>Mass prayers for this day are not available.</p>
                {% endfor %}
            </section>

            <!-- ================================================================ -->
            <!-- 4. Future Add-on Section (Homilies, Reflections)               -->
            <!-- ================================================================ -->
            <section id="homily-section" class="mt-4">
                <h4>Homily Notes & Reflections</h4>
                <p>Share your reflections on today's Word, or if you are a priest, post your homily.</p>
                <textarea placeholder="Contribute your reflection..." class="w-100" rows="4" style="padding: 10px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
                <div class="d-flex justify-content-end mt-2">
                    <button class="btn btn-sm btn-primary">Submit Reflection</button>
                </div>
                 <!-- A container for comments/homilies will go here -->
            </section>

        {% else %}
            <!-- Displayed if the API call fails or returns no data -->
            <div class="alert alert-warning" role="alert">
              <h4 class="alert-heading">Content Unavailable</h4>
              <p>We could not retrieve the liturgical data for the selected day. Please try a different date or check back later.</p>
              <hr>
              <p class="mb-0">{{ liturgy_data.get('error', 'An unknown error occurred.') }}</p>
            </div>
        {% endif %}

    </div>
{% endblock %}